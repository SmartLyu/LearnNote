# SQL

## 基础概念

DB，数据库，是存储数据的集合，即多个数据表

DBMS，数据库管理系统，例如`oracle、mysql`

SQL的有关系型数据库，也有NoSQL的非关系型(键值型、文档型)数据库

## 执行流程

### Oracle

1. 语法检查：检查SQL的拼写是否有问题
2. 语义检查：检查SQK中的对象是否存在
3. 权限检查：判断用户是否有访问该数据的权限
4. 共享池检查：
   - 判断共享池中是否有缓存该语句的执行任务
   - 如果有就进行`软解析`直接到执行环节
   - 如果没有就需要进行`硬解析`，生成执行计划，进入优化环节，再进入执行

* 优化选择

  减少`硬解析`的情况，具体方法：`select * from A where id = 1` => `select * from A where id = :id`，这样每次修改变量进行`软解析`即可完成需求，但是这样的SQL优化会变困难

### Mysql

采用C/S架构，整个有三层组成：

- 连接层：客户端和服务端建立连接的模块
- SQL层
  - 对SQL进行查询，这里的逻辑和存储方式没有关系
- 存储引擎层
  - 存储引擎采用插件的形式，可以有InnoDB(支持事务、行级锁定、外键约束)、MyISAM(速度快、资源消耗小)等

流程 `SQL语句 -> 缓存查询 -> 解析器 -> 优化器 -> 执行器`

## 设计表的原则

主要是：**三少一多**的原则，核心即**简单可复用** 

1. 数据表个数越少越好
   - DBMS的和兴在于实体和联系的定义(E-R图)，数据表越少，代表联系的设定月简洁，方便理解和操作
2. 字段个数越少越好
   - 基础要求是每个字段相互独立，而不是通过其他字段计算出来的
   - 字段个数越多，冗余可能性越大
3. 联合主键越少越好
   - 联合的主键越多，索引空间就需要更多，运行时间越久
4. 主键和外键越多越好
   - 关系越多，代表实体间的冗余度越低，利用率越高
   - 不仅保证了表的独立性，还提高了关联利用率

## 查询语句

### 基础

`select 字段 as 别名 from 表 where 条件`

### 去重

`select distinct 字段1, 字段2 from 表`

- `distinct` 必须在所有的列明前面，如果放在中间或后面会报错
- 去重是对后面所有字段去重，只有选择的字段都相同的情况才会认定为重复

### 排序

`select 字段 as 别名 from 表 where 条件 order by 字段 DESC`

- `order by` 必须是最后一个子句，否则会报错
- 排序的顺序，可以在order后面注明，`AES`代表递增(第一行最小)，`DESC`代表递减(第一行最大)
- 排序可以写多个字段，排序会按照第一个字段排序后，相同字段再对第二个字段排序以此类推

### 限制返回数量

`select xxxx limit 10 `

### 执行顺序

关键字的排列顺序：`select .. from .. where .. group by .. having .. order by ..`

执行顺序： `from -> where -> group by -> having -> order by -> limit`
